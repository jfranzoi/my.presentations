require 'rake'
require 'fileutils'

task :default => [:clean, :build]

TEX_FILE = 'session.tex'
PROJECT_NAME = File.basename(Dir.getwd)
BUILD_FOLDER = 'build'

desc "Clean files"
task :clean do
  recreate BUILD_FOLDER
end

desc "Compile document"
task :build => [:clean] do
	pdflatex TEX_FILE, BUILD_FOLDER
end

desc "Open compiled document"
task :open => [:build] do
  open_at BUILD_FOLDER, "#{PROJECT_NAME}.pdf"
end


private

def recreate(folder)
  puts "Recreating folder: #{folder}..."
  FileUtils.rm_rf folder
  FileUtils.mkdir folder
end

def pdflatex(tex_file, into)
  puts "Processing file: #{tex_file}"
  `pdflatex -output-directory #{into} -jobname=#{PROJECT_NAME} #{tex_file}`

  puts "Processed file: #{into}/#{PROJECT_NAME}.pdf"
end

def open_at(folder, file)
  system "open #{folder}/#{file}"
end